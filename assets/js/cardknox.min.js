jQuery(function(a){a("form.checkout, form#order_review").on("change",'input[name="wc-cardknox-payment-token"]',function(){"new"===a('.cardknox-legacy-payment-fields input[name="wc-cardknox-payment-token"]:checked').val()?a(".cardknox-legacy-payment-fields #cardknox-payment-data").slideDown(200):a(".cardknox-legacy-payment-fields #cardknox-payment-data").slideUp(200)});var b={init:function(){this.onIfieldloaded();a("form.woocommerce-checkout").length&&(this.form=a("form.woocommerce-checkout"));a("form.woocommerce-checkout").on("checkout_place_order_cardknox",
this.onSubmit);a("form#order_review").length&&(this.form=a("form#order_review"));a("form#order_review").on("submit",this.onSubmit);a("form#add_payment_method").length&&(this.form=a("form#add_payment_method"));a("form#add_payment_method").on("submit",this.onSubmit);a(document).on("change","#wc-cardknox-cc-form :input",this.onCCFormChange).on("cardknoxError",this.onError).on("checkout_error",this.clearToken)},isCardknoxChosen:function(){return a("#payment_method_cardknox").is(":checked")&&(!a('input[name="wc-cardknox-payment-token"]:checked').length||
"new"===a('input[name="wc-cardknox-payment-token"]:checked').val())},hasExp:function(){return 0<a("input.xExp").length},block:function(){b.form.block({message:null,overlayCSS:{background:"#fff",opacity:.6}})},unblock:function(){b.form.unblock()},onError:function(c,d){console.log("onError");a(".wc-cardknox-error, .xExp").remove();a("#cardknox-card-number").closest("p").before('<ul class="woocommerce_error woocommerce-error wc-cardknox-error"><li>'+d+"</li></ul>");b.unblock()},onSubmit:function(c){console.log("onSubmit");
if(b.isCardknoxChosen()&&!b.hasExp())return c.preventDefault(),b.block(),setAccount(wc_cardknox_params.key,"wordpress","1.0.0"),""===document.getElementById("cardknox-card-number").value&&a(document).trigger("cardknoxError","card number required"),setAccount(wc_cardknox_params.key,"wordpress","0.1.2"),getTokens(function(){console.log("Success");b.onCardknoxResponse()},function(){console.log("error");b.unblock();a(document).trigger("cardknoxError",document.getElementById("ifieldsError").textContent);
return!1},3E4),!1},onCCFormChange:function(){a(".wc-cardknox-error, .xExp").remove()},onCardknoxResponse:function(){var c=a("#cardknox-card-expiry").payment("cardExpiryVal");c=c.month.toString()+c.year.toString().substr(2,2);console.log("onCardknoxResponse");b.form.append("<input type='hidden' class='xExp' name='xExp' value='"+c+"'/>");b.form.submit()},onIfieldloaded:function(){setIfieldStyle("card-number",{border:"0","border-left-color":"rgb(67, 69, 75)","font-size":"19.8px",padding:"12.25px",width:"225px",
height:"32px","background-color":"rgb(242, 242, 242)","font-weight":"400"});setIfieldStyle("cvv",{border:"0","border-left-color":"rgb(67, 69, 75)","font-size":"19.8px",padding:"12.25px",width:"106px",height:"32px","background-color":"rgb(242, 242, 242)","font-weight":"400"})}};b.init()});
